"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("events"),n=require("fs"),t=require("path"),r=require("os"),o=require("child_process");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=a(n),s=a(t),l=a(r),c=a(o),u="build-pynsist";function d(e){return atom.config.get(`${u}.${e}`)}var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(e){var n={exports:{}};return e(n,n.exports),n.exports}function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=g(l.default),y=g(i.default),m=g(s.default);const v=/\s+at.*(?:\(|\s)(.*)\)?/,w=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,b=void 0===h.default.homedir?"":h.default.homedir();class E extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let n=(e=[...e].map((e=>e instanceof Error?e:null!==e&&"object"==typeof e?Object.assign(new Error(e.message),e):new Error(e)))).map((e=>{return"string"==typeof e.stack?(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""))((n=e.stack,t=Object.assign({pretty:!1},t),n.replace(/\\/g,"/").split("\n").filter((e=>{const n=e.match(v);if(null===n||!n[1])return!0;const t=n[1];return!t.includes(".app/Contents/Resources/electron.asar")&&!t.includes(".app/Contents/Resources/default_app.asar")&&!w.test(t)})).filter((e=>""!==e.trim())).map((e=>t.pretty?e.replace(v,((e,n)=>e.replace(n,n.replace(b,"~")))):e)).join("\n"))):String(e);var n,t})).join("\n");n="\n"+((e,n=1,t)=>{if(t={indent:" ",includeEmptyLines:!1,...t},"string"!=typeof e)throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if("number"!=typeof n)throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof n}\``);if("string"!=typeof t.indent)throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof t.indent}\``);if(0===n)return e;const r=t.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(r,t.indent.repeat(n))})(n,4),super(n),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var k=E;const P=(e,n,t)=>new Promise(((r,o)=>{if(t=Object.assign({concurrency:1/0},t),"function"!=typeof n)throw new TypeError("Mapper function is required");const{concurrency:a}=t;if(!("number"==typeof a&&a>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);const i=[],s=e[Symbol.iterator]();let l=!1,c=!1,u=0,d=0;const p=()=>{if(l)return;const e=s.next(),t=d;if(d++,e.done)return c=!0,void(0===u&&r(i));u++,Promise.resolve(e.value).then((e=>n(e,t))).then((e=>{i[t]=e,u--,p()}),(e=>{l=!0,o(e)}))};for(let e=0;e<a&&(p(),!c);e++);}));var x=P,_=P;x.default=_;const T=async(e,n,t)=>(await x(e,((e,t)=>Promise.all([n(e,t),e])),t)).filter((e=>Boolean(e[0]))).map((e=>e[1]));var S=T,A=T;S.default=A;const j="undefined"!=typeof atom,$="undefined"!=typeof atom&&(atom.inDevMode()||atom.inSpecMode());
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */
var C=/["'&<>]/,D=function(e){var n,t=""+e,r=C.exec(t);if(!r)return t;var o="",a=0,i=0;for(a=r.index;a<t.length;a++){switch(t.charCodeAt(a)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}i!==a&&(o+=t.substring(i,a)),i=a+1,o+=n}return i!==a?o+t.substring(i,a):o};function N(e,n,t){let r;const o=async function(e,n,t){const r=c.default.spawn(e,n,t),o=new Promise(((e,n)=>{const o={stdout:r.stdout?[]:null,stderr:r.stderr?[]:null};r.on("error",n),r.stdout&&r.stdout.on("data",(function(e){o.stdout.push(e),t.handleStdout&&t.handleStdout(e)})),r.stderr&&r.stderr.on("data",(function(e){o.stderr.push(e),t.handleStderr&&t.handleStderr(e)})),r.on("close",(n=>{let r=null;null!=o.stdout&&(r=null===t.encoding||"buffer"===t.encoding?Buffer.concat(o.stdout):o.stdout.join(""));let a=null;null!=o.stderr&&(a=null===t.encoding||"buffer"===t.encoding?Buffer.concat(o.stderr):o.stderr.join("")),e({exitCode:n,stdout:r,stderr:a})}))}));return t.handleChildProcess(r),o}(e,n,{...t,handleChildProcess(e){r=e}});return o.kill=function(e){return r.kill(e)},o}async function I(e){if(j){const n=await async function(e){var n;const t=atom.packages.getLoadedPackage(e.name);return null==t?null:null!==(n=t.metadata.version)&&void 0!==n?n:null}(e);if(n)return n}return async function(e){var n,t;const{directory:r}=e;if(null==r)return null;let o=null;try{o=JSON.parse(await y.default.promises.readFile(m.default.join(r,"package.json"),"utf8"))}catch(e){return null}return null!==(n=null===(t=o)||void 0===t?void 0:t.version)&&void 0!==n?n:null}(e)}const O=j?async function(e){return atom.packages.resolvePackagePath(e)}:async function(e){var n;const t=m.default.join(null!==(n=process.env.ATOM_HOME)&&void 0!==n?n:m.default.join(h.default.homedir(),".atom"),"packages",e);try{return await y.default.promises.access(t,y.default.constants.R_OK),t}catch(e){return null}};function M(e,n){if(!e)throw new Error(null!=n?n:"Invariant violation")}async function F(e){const n=await(j?async function(e){const n=atom.packages.getLoadedPackage(e),t=n&&n.metadata["package-deps"];return Array.isArray(t)?t:[]}(e):async function(e){let n=null;try{n=await y.default.promises.stat(e)}catch(e){}if(null==n||!n.isDirectory())throw new Error("[Package-Deps] Expected packageName to be a readable directory in Node.js invocation");let t=null;try{const n=await y.default.promises.readFile(m.default.join(e,"package.json"),"utf8");t=JSON.parse(n)}catch(e){}const r=null==t||"object"!=typeof t?[]:t["package-deps"];return Array.isArray(r)?r:[]}(e));return $&&(M(Array.isArray(n),`Dependencies for ${e} are not a valid array`),n.forEach(((n,t)=>{if(Array.isArray(n))n.forEach(((n,r)=>{const o=`Dependency#${t}#${r} for ${e} is invalid`;M("string"==typeof n.name&&n.name.length>0,o),M(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,o)})),M(n.length>0,`Dependency#${t} for ${e} has no group items`);else{const r=`Dependency#${t} for ${e} is invalid`;M("string"==typeof n.name&&n.name.length>0,r),M(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,r)}}))),n}async function L(e){if(null==e.directory)return!0;if(null==e.minimumVersion)return!1;const n=await I(e);return null==n||1===function(e,n){for(var t=e.split("."),r=n.split("."),o=0;o<3;o++){var a=Number(t[o]),i=Number(r[o]);if(a>i)return 1;if(i>a)return-1;if(!isNaN(a)&&isNaN(i))return 1;if(isNaN(a)&&!isNaN(i))return-1}return 0}(e.minimumVersion,n)}const V=new Set(["âœ“","done"]),q=/(?:Installing|Moving) (.*?) to .* (.*)/;async function H(e){if("string"==typeof e)return{name:e,directory:await O(e)};if("name"in e)return{...e,directory:await O(e.name)};throw console.error("This package-deps entry is not valid. Please see https://github.com/steelbrain/package-deps#how-it-works",{entry:e}),Error("The package-deps entry is not valid. Please see https://github.com/steelbrain/package-deps#how-it-works")}let W=!0;const B=j?function({packageName:e,dependencies:n}){const t=[],r=atom.notifications.addInfo(`Installing ${e} dependencies`,{detail:`Installing ${n.map((e=>e.name)).join(", ")}`,dismissable:!0}),o=document.createElement("progress");o.max=n.length,o.style.width="100%";try{var a;const e=atom.views.getView(r),n=null!==(a=null==e?void 0:e.element)&&void 0!==a?a:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");t.appendChild(o)}catch(e){console.error("[Package-Deps] Error during showing installation progress to user",e)}return{handleFailure({dependency:e,error:n}){var r;t.push(e.name),o.value+=1,console.error(`[Package-Deps] Unable to install ${e.name}, Error:`,null!==(r=null==n?void 0:n.stack)&&void 0!==r?r:n)},handleDependencyInstalled(e){o.value+=1},handleComplete(){r.dismiss(),t.length>0?atom.notifications.addWarning(`Failed to install ${e} dependencies`,{detail:`These packages were not installed, check your console\nfor more info.\n${t.join("\n")}`,dismissable:!0}):atom.notifications.addSuccess(`Installed ${e} dependencies`,{detail:`Installed ${n.map((e=>e.name)).join(", ")}`}),Promise.all(n.map((e=>t.includes(e.name)?null:atom.packages.activatePackage(e.name)))).catch((n=>{console.error(`[Package-Deps] Error activating installed packages for ${e}`,n)}))}}}:function({dependencies:e}){let n=!1;return console.log(`Installing dependencies:\n${e.map((e=>`  - ${e.name}`)).join("\n")}`),{handleFailure({dependency:e,error:t}){var r;n=!0,console.error(`Unable to install ${e.name}, Error:`,null!==(r=null==t?void 0:t.stack)&&void 0!==r?r:t)},handleDependencyInstalled(e){console.log("Successfully installed",e.name)},handleComplete(){console.log("Installation complete"),n&&(process.exitCode=1)}}},G=j?function({packageName:e,dependencies:n}){return new Promise((t=>{const r=n.filter((e=>!Array.isArray(e))),o=n.filter((e=>Array.isArray(e))),a=0===o.length,i=a?r.map((e=>e.name)).join(", "):"Something went wrong. Check your developer console",s=o.map((e=>e[0]));atom.packages.isPackageDisabled("notifications")&&console.warn(`Enable notifications to install dependencies for ${e}`);const l=atom.notifications.addInfo(`${e} needs to install dependencies`,{dismissable:!0,icon:"cloud-download",detail:i,description:`Install dependenc${1===n.length?"y":"ies"}?`,buttons:[{text:"Yes",onDidClick:()=>{t(a?r:r.concat(s)),l.dismiss()}},{text:"No Thanks",onDidClick:()=>{l.dismiss()}},{text:"Never",onDidClick:()=>{!function(e){var n;if(!j)return;const t=new Set(null!==(n=atom.config.get("atom-package-deps.ignored"))&&void 0!==n?n:[]);t.add(e),atom.config.set("atom-package-deps.ignored",Array.from(t))}(e),W&&(W=!1,atom.notifications.addInfo("How to reset package-deps memory",{dismissable:!0,description:"To modify the list of ignored files invoke 'Application: Open Your Config' and change the 'atom-package-deps' section"})),l.dismiss()}}]});if(l.onDidDismiss((()=>t([]))),!a)try{var c;const e=atom.views.getView(l),n=null!==(c=null==e?void 0:e.element)&&void 0!==c?c:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");if(t.innerHTML="",r.length>0){const e=document.createElement("div");e.innerHTML=`Packages without choices: <br /><ul><li>${r.map((e=>D(e.name))).join("</li><li>")}</li></ul>`,t.appendChild(e)}const a=document.createElement("div");a.innerHTML="Packages with choices:",t.appendChild(a);const i=document.createElement("ul");o.forEach(((e,n)=>{const t=document.createElement("li"),r=document.createElement("select");r.innerHTML=e.map((e=>`<option>${D(e.name)}</option>`)).join("\n"),r.addEventListener("change",(()=>{const t=e.find((e=>e.name===r.value));null!=t&&(s[n]=t)})),t.style.marginTop="5px",t.appendChild(r),i.appendChild(t)})),t.appendChild(i)}catch(e){console.error("[Package-Deps] Error during showing package choices to user",e)}}))}:async function({dependencies:e}){return e.map((e=>Array.isArray(e)?e[0]:e))};var J=async function(e,n=!1){if(M("string"==typeof e&&e.length>0,"[Package-Deps] Package name is required"),function(e){var n;return!!j&&!!(null!==(n=atom.config.get("atom-package-deps.ignored"))&&void 0!==n?n:[]).includes(e)}(e))return;const t=await F(e);if(0===t.length)return;const r=await Promise.all(t.map((async e=>Array.isArray(e)?Promise.all(e.map(H)):H(e)))),o=await S(r,(async function(e){return Array.isArray(e)?(await Promise.all(e.map((e=>L(e))))).every(Boolean):L(e)}));if(0===o.length)return;let a;if(a=n?o.map((e=>Array.isArray(e)?e[0]:e)):await G({packageName:e,dependencies:o}),0===a.length)return;const i=B({packageName:e,dependencies:a});await(async(e,n,{concurrency:t=1/0,stopOnError:r=!0}={})=>new Promise(((o,a)=>{if("function"!=typeof n)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(t)&&t!==1/0||!(t>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${t}\` (${typeof t})`);const i=[],s=[],l=e[Symbol.iterator]();let c=!1,u=!1,d=0,p=0;const f=()=>{if(c)return;const e=l.next(),t=p;if(p++,e.done)return u=!0,void(0===d&&(r||0===s.length?o(i):a(new k(s))));d++,(async()=>{try{const r=await e.value;i[t]=await n(r,t),d--,f()}catch(e){r?(c=!0,a(e)):(s.push(e),d--,f())}})()};for(let e=0;e<t&&(f(),!u);e++);})))(a,(async function(e){try{await async function(e){const n=j?`"${atom.packages.getApmPath()}"`:"apm",{stdout:t,stderr:r}=await N(n,["install",e.name,"--production","--color","false"],{shell:!0}),o=q.exec(t.trim());if(null!=o&&V.has(o[2]))return;const a=new Error(`Error installing dependency: ${e.name}`);throw a.stack=r.trim(),a}(e),i.handleDependencyInstalled(e)}catch(n){i.handleFailure({dependency:e,error:n})}}),{concurrency:2}),i.handleComplete()},U=Object.defineProperty({install:J},"__esModule",{value:!0});const Y=()=>{const e=Error.prepareStackTrace;Error.prepareStackTrace=(e,n)=>n;const n=(new Error).stack.slice(1);return Error.prepareStackTrace=e,n};var R=Y,X=Y;R.default=X;var K=f((function(e,n){var t=p&&p.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}l((r=r.apply(e,n||[])).next())}))},r=p&&p.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.readManifestSync=n.readManifest=void 0;var o=s.default.resolve,a=s.default.sep,l=i.default.promises,c=i.default.readFileSync;function u(e){e=(null==e?void 0:e.length)?e:function(){var e=(({depth:e=0}={})=>{const n=[],t=new Set;for(const r of R()){const o=r.getFileName(),a=null!==r.getTypeName()&&null!==o;if(t.has(o)||(t.add(o),n.unshift(r)),a)return n[e]}})().getFileName(),n=atom.packages.getPackageDirPaths().filter((function(n){return e.startsWith(n)}));if(null==n?void 0:n.length)return e.replace(n[0],"").split(a).filter((function(e){return e}))[0]||"";return""}();var n=atom.packages.resolvePackagePath(e);return o(n,"package.json")}n.readManifest=function(e){return void 0===e&&(e=""),t(this,void 0,void 0,(function(){var n,t;return r(this,(function(r){switch(r.label){case 0:n=u(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l.readFile(n,"utf8")];case 2:return t=r.sent(),[2,JSON.parse(t)];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},n.readManifestSync=function(e){void 0===e&&(e="");var n=u(e);try{var t=c(n,"utf8");return JSON.parse(t)}catch(e){return null}}})),z=f((function(e,n){var t=p&&p.__assign||function(){return(t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},r=p&&p.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}l((r=r.apply(e,n||[])).next())}))},o=p&&p.__generator||function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.satisfyDependencies=void 0;var a={logger:console.log};n.satisfyDependencies=function(e,n){return void 0===n&&(n={}),r(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:return r=t(t({},a),n),[4,K.readManifest(e)];case 1:return i=o.sent(),[4,U.install(i.name)];case 2:return o.sent(),function(e,n){n.enableDependencies&&e["package-deps"].map((function(t){atom.packages.isPackageDisabled(t)&&(atom.inDevMode()&&n.logger("["+e.name+"] Enabling package dependency '"+t+"'"),atom.packages.enablePackage(t))}))}(i["package-deps"],r),[2]}}))}))}}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function Q(e,n){for(var t=0,r=n.length,o=e.length;t<r;t++,o++)e[o]=n[t];return e}var Z=new(function(){function e(e){void 0===e&&(e={}),this.name=e.name,this.styleSheet="\n      background-color: "+(e.backgroundColor||"darkgrey")+";\n      border-radius: 2px;\n      color: "+(e.color||"white")+";\n      line-height: 1.5;\n      padding: 1px 4px;\n      text-shadow: 0 1px 0px rgba(0, 0, 0, 0.2);\n    "}return e.prototype.__console__=function(e){for(var n,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];(null===atom||void 0===atom?void 0:atom.inDevMode())&&(t.unshift("%c"+this.name+"%c",this.styleSheet,""),(n=window.console)[e].apply(n,t))},e.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["debug"],e))},e.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["error"],e))},e.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["info"],e))},e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["log"],e))},e.prototype.trace=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["trace"],e))},e.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.__console__.apply(this,Q(["warn"],e))},e}())({name:u,backgroundColor:"rosybrown"}),ee=te;function ne(e,n,t){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,n){var t=void 0!==n.pathExt?n.pathExt:process.env.PATHEXT;if(!t)return!0;if(-1!==(t=t.split(";")).indexOf(""))return!0;for(var r=0;r<t.length;r++){var o=t[r].toLowerCase();if(o&&e.substr(-o.length).toLowerCase()===o)return!0}return!1}(n,t)}function te(e,n,t){i.default.stat(e,(function(r,o){t(r,!r&&ne(o,e,n))}))}te.sync=function(e,n){return ne(i.default.statSync(e),e,n)};var re,oe=ae;function ae(e,n,t){i.default.stat(e,(function(e,r){t(e,!e&&ie(r,n))}))}function ie(e,n){return e.isFile()&&function(e,n){var t=e.mode,r=e.uid,o=e.gid,a=void 0!==n.uid?n.uid:process.getuid&&process.getuid(),i=void 0!==n.gid?n.gid:process.getgid&&process.getgid(),s=parseInt("100",8),l=parseInt("010",8),c=parseInt("001",8),u=s|l;return t&c||t&l&&o===i||t&s&&r===a||t&u&&0===a}(e,n)}ae.sync=function(e,n){return ie(i.default.statSync(e),n)},re="win32"===process.platform||p.TESTING_WINDOWS?ee:oe;var se=le;function le(e,n,t){if("function"==typeof n&&(t=n,n={}),!t){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(t,r){le(e,n||{},(function(e,n){e?r(e):t(n)}))}))}re(e,n||{},(function(e,r){e&&("EACCES"===e.code||n&&n.ignoreErrors)&&(e=null,r=!1),t(e,r)}))}le.sync=function(e,n){try{return re.sync(e,n||{})}catch(e){if(n&&n.ignoreErrors||"EACCES"===e.code)return!1;throw e}};const ce="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,ue=ce?";":":",de=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),pe=(e,n)=>{const t=n.colon||ue,r=e.match(/\//)||ce&&e.match(/\\/)?[""]:[...ce?[process.cwd()]:[],...(n.path||process.env.PATH||"").split(t)],o=ce?n.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",a=ce?o.split(t):[""];return ce&&-1!==e.indexOf(".")&&""!==a[0]&&a.unshift(""),{pathEnv:r,pathExt:a,pathExtExe:o}},fe=(e,n,t)=>{"function"==typeof n&&(t=n,n={}),n||(n={});const{pathEnv:r,pathExt:o,pathExtExe:a}=pe(e,n),i=[],l=t=>new Promise(((o,a)=>{if(t===r.length)return n.all&&i.length?o(i):a(de(e));const l=r[t],u=/^".*"$/.test(l)?l.slice(1,-1):l,d=s.default.join(u,e),p=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+d:d;o(c(p,t,0))})),c=(e,t,r)=>new Promise(((s,u)=>{if(r===o.length)return s(l(t+1));const d=o[r];se(e+d,{pathExt:a},((o,a)=>{if(!o&&a){if(!n.all)return s(e+d);i.push(e+d)}return s(c(e,t,r+1))}))}));return t?l(0).then((e=>t(null,e)),t):l(0)};var ge=fe;fe.sync=(e,n)=>{n=n||{};const{pathEnv:t,pathExt:r,pathExtExe:o}=pe(e,n),a=[];for(let i=0;i<t.length;i++){const l=t[i],c=/^".*"$/.test(l)?l.slice(1,-1):l,u=s.default.join(c,e),d=!c&&/^\.[\\\/]/.test(e)?e.slice(0,2)+u:u;for(let e=0;e<r.length;e++){const t=d+r[e];try{if(se.sync(t,{pathExt:o})){if(!n.all)return t;a.push(t)}}catch(e){}}}if(n.all&&a.length)return a;if(n.nothrow)return null;throw de(e)},exports.activate=async function(){!0===d("manageDependencies")&&z.satisfyDependencies(u)},exports.config={pathToPynsist:{title:"Path to Pynsist",description:"Specify the full path to `pynsist`",type:"string",default:"pynsist",order:0},mutePathWarning:{title:"Mute Warning",description:"When enabled, warnings about missing path to `pynsist` will be muted",type:"boolean",default:!1,order:1},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:!0,order:3},alwaysEligible:{title:"Always Eligible",description:"The build provider will be available in your project, even when not eligible",type:"boolean",default:!1,order:4}},exports.provideBuilder=function(){return class extends e.EventEmitter{constructor(e){super(),this.cwd=e,atom.config.observe("build-pynsist.pathToPynsist",(()=>this.emit("refresh")))}getNiceName(){return"Pynsist"}async isEligible(){if(!0===d("alwaysEligible"))return Z.log("Always eligible"),!0;const e=atom.project.getPaths()[0],r=void 0!==e&&n.existsSync(t.join(e,"installer.cfg")),o=atom.workspace.getActiveTextEditor(),a=void 0!==o&&o.getPath(),i=!1!==a&&n.existsSync(t.join(a,"installer.cfg")),s=!(!r&&!i),l=d("pathToPynsist"),c=Boolean(ge.sync(l,{nothrow:!0}));if(!0===c&&!0===s)return!0;if(!1===c&&!1===d("mutePathWarning")){const e=atom.notifications.addWarning(`**${u}**: No valid \`pynsist\` was specified in your settings`,{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){atom.workspace.open(`atom://config/packages/${u}`,{pending:!0,searchAllPanes:!0}),e.dismiss()}},{text:"Ignore",onDidClick:function(){atom.config.set(`${u}.mutePathWarning`,!0),e.dismiss()}}]})}return!1}settings(){const e=d("pathToPynsist");return[{name:"Pynsist: Compile Installer",exec:e,args:["{FILE_ACTIVE}"],cwd:"{FILE_ACTIVE_PATH}",sh:!1,keymap:"cmd-alt-b"},{name:"Pynsist: Generate Script",exec:e,args:["--no-makensis","{FILE_ACTIVE}"],cwd:"{FILE_ACTIVE_PATH}",sh:!1,keymap:"cmd-alt-b"}]}}};
//# sourceMappingURL=provider.js.map
